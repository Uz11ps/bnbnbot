{% extends "base.html" %}
{% block content %}
<div class="card p-4">
    <h4><i class="bi bi-gear me-2"></i> –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h4>
    
    <form action="/settings/update" method="post" class="mt-3">
        <div class="mb-4">
            <label class="form-label fw-bold">üìú –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ</label>
            <textarea name="agreement" class="form-control" rows="10">{{ agreement }}</textarea>
            <div class="form-text">–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –±–æ—Ç–∞.</div>
        </div>

        <div class="mb-4">
            <label class="form-label fw-bold">üì¢ ID Telegram –∫–∞–Ω–∞–ª–∞ (–¥–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏)</label>
            <div class="input-group">
                <input type="text" name="channel_id" class="form-control" value="{{ channel_id }}" placeholder="-100123456789">
                <button type="button" class="btn btn-outline-secondary" onclick="testChannel()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
            </div>
            <div class="form-text">–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –æ—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –≤ –∫–∞–Ω–∞–ª–µ.</div>
            <div id="channelTestResult" class="mt-2 small"></div>
        </div>

        <script>
        async function testChannel() {
            const resDiv = document.getElementById('channelTestResult');
            resDiv.innerHTML = '<span class="text-muted">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>';
            try {
                const resp = await fetch('/settings/test_channel', {method: 'POST'});
                const data = await resp.json();
                if (data.status === 'success') {
                    resDiv.innerHTML = '<span class="text-success">‚úÖ ' + data.message + '</span>';
                } else {
                    resDiv.innerHTML = '<span class="text-danger">‚ùå ' + data.message + '</span>';
                }
            } catch (e) {
                resDiv.innerHTML = '<span class="text-danger">‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ' + e + '</span>';
            }
        }
        </script>

        <div class="mb-4">
            <label class="form-label fw-bold">üîó –°—Å—ã–ª–∫–∞ –Ω–∞ Telegram –∫–∞–Ω–∞–ª</label>
            <input type="text" name="channel_url" class="form-control" value="{{ channel_url }}" placeholder="https://t.me/bnbslow">
            <div class="form-text">–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –¥–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏.</div>
        </div>

        <div class="mb-4">
            <label class="form-label fw-bold">üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è)</label>
            <textarea name="howto" class="form-control" rows="10">{{ howto }}</textarea>
            <div class="form-text">–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è" –≤ –±–æ—Ç–µ –∏ –Ω–∞ —Å–∞–π—Ç–µ.</div>
        </div>

        <div class="mb-4">
            <label class="form-label fw-bold">üí¨ –ö–æ–Ω—Ç–∞–∫—Ç –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è</label>
            <input type="text" name="support_contact" class="form-control" value="{{ support_contact }}" placeholder="https://t.me/bnbslow –∏–ª–∏ @username –∏–ª–∏ email@example.com">
            <div class="form-text">–°—Å—ã–ª–∫–∞ –Ω–∞ Telegram, email ‚Äî –¥–ª—è —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ —Å–∞–π—Ç–µ.</div>
        </div>

        <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
    </form>
</div>
{% endblock %}


